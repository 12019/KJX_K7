/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE.
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*****************************************************************************
 *
 * Filename:
 * ---------
 * VappBrowserMain.h
 *
 * Project:
 * --------
 *   MAUI
 *
 * Description:
 * ------------
 *   
 *
 * Author:
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/

#ifndef _VAPP_BRW_MAIN_H_
#define _VAPP_BRW_MAIN_H_

#include "MMI_include.h"
#include "MMIDataType.h"

#ifdef __MMI_BROWSER_2__

//#include "vrt_system.h"

#include "vfx_mc_include.h"
#include "vcp_include.h"
#include "vcp_page_panel.h"

#include "vapp_brw_favourites.h"
#include "vapp_brw_settings.h"
#include "vapp_brw_url_input.h"
#include "vapp_brw_home_page.h"
#include "mmi_rp_vapp_browser_def.h"
#include "ui_core\base\vfx_datatype.h"
#include "mmi_rp_app_cosmos_global_def.h"
#include "vapp_brw_title_bar.h"
#include "vapp_brw_struct.h"
#include "Lcd_sw_inc.h"
#include "mmi_rp_srv_venus_component_list_menu_def.h"

#ifdef __cplusplus
extern "C"
{
#endif /* __CPLUSPLUS__ */
#include "BrowserSrvInterface.h"
#include "BrowserSrvBookmarks.h"
#include "BrowserSrvGprot.h"
#include "BrowserSrvMain.h"
#include "gdi_include.h"
#include "FileMgrSrvGprot.h"
#include "Bam_api.h"
#include "Wps_struct.h"

extern void vrt_set_video_layer(vrt_sys_video_layer_index_enum index, gdi_handle layer, vrt_s32 order);
extern gdi_handle vrt_get_blt_layer(void);

extern void widget_paintbox_create_doubble_buffer( 
        U32 x,
        U32 y,
        U32 w,
        U32 h);
extern void widget_paintbox_recreate_double_buffer( 
        U32 x,
        U32 y,
        U32 w,
        U32 h);
extern gdi_handle paintbox_layer_handle;
extern gdi_handle temp_layer_handle;
extern void widget_paintbox_free_doubble_buffer(void);
extern void widget_paintbox_relayout(void);
extern void widget_draw_full_screen_mode_icon(
		U32 x,
        U32 y,
        U32 w,
        U32 h,
		U32 img_id);
extern void widget_remove_full_screen_mode_icon(void);
extern void widget_set_screen_rotate_mode(MMI_BOOL rotate_mode);
extern void widget_set_coordinates_screen(S32 x1, S32 y1, S32 x2, S32 y2);

#ifdef __cplusplus
}
#endif /* __cplusplus */


#define BRW_UPLOAD_COMPLETED_TIMER_VALUE        2000
#ifdef __MMI_URI_AGENT__
#define BRW_HTTP_URI_SCHEME                 "http"
#define BRW_HTTPS_URI_SCHEME			    "https"
#define BRW_FILE_URI_SCHEME                 "file"
#endif /* __MMI_URI_AGENT__ */
#define BRW_TEMP_VBKM_FILE_DRIVE            SRV_FMGR_SYSTEM_DRV
#define BRW_TEMP_VBKM_FILE_PATH             L"\\@vbookmarks\\vbookmark.url"
#define BRW_DEFAULT_ENTER_ADDR_STR          "http://"
#define BRW_HOMEPAGE_URL_STR          L"about:homepage"

#define BRW_HOMEPAGE_SNAPSHOT_FILE_DRIVE            SRV_FMGR_PUBLIC_DRV
#define BRW_HOMEPAGE_SHORTCUT_FOLDER_NAME          "Browser"

#if defined(__MMI_MAINLCD_320X480__)
#define BRW_DETAILS_MARGIN   8
#else
#define BRW_DETAILS_MARGIN   5
#endif

#define BRW_DEFAULT_SHORTCUT_TOTAL (IMG_ID_VAPP_BRW_SNAPSHOT_END - IMG_ID_VAPP_BRW_SNAPSHOT_BEGIN - 1)
enum
{
    BRW_PAGE_RENDERED_PAGE = 1,
    BRW_PAGE_FAVORITES,
    BRW_PAGE_STORED_PAGE_DETAILS,
    BRW_PAGE_BOOKMARK_DETAILS,
    BRW_PAGE_BOOKMARK_FOLDER,
    BRW_PAGE_ADD_BOOKMARK,
    BRW_PAGE_SELECT_FOLDER,
    BRW_PAGE_EDIT_SHORTCUT,
    BRW_PAGE_ADD_PAGE,
    BRW_PAGE_LIST_MENU,
    BRW_PAGE_SETTINGS,
    #ifdef __MMI_BRW_SLIM__
	BRW_PAGE_BOOKMARK,
	#endif
    BRW_PAGE_END
};

enum
{
#if defined(__MMI_MAINLCD_320X480__)
    HOME_PAGE_ICON_WIDTH = 94 - 4,
    ROTATED_HOME_PAGE_ICON_WIDTH = 84 - 4,
    HOME_PAGE_ICON_HEIGHT = 85 - 2,
    ROTATED_HOME_PAGE_ICON_HEIGHT = 61 - 2,
    HOME_PAGE_ICON_TEXT_HEIGHT = 20 - 2,
    ROTATED_HOME_PAGE_ICON_TEXT_HEIGHT = 20 - 2,
    HOME_PAGE_ICON_LOCK_WIDTH = 12,
    ROTATED_HOME_PAGE_ICON_LOCK_WIDTH = 12,
    HOME_PAGE_ICON_LOCK_HEIGHT = 12,
    ROTATED_HOME_PAGE_ICON_LOCK_HEIGHT = 12,
    HOME_PAGE_ICON_TITLE_MARGIN = 8,
    ROTATED_HOME_PAGE_ICON_TITLE_MARGIN = 5,
    HOME_PAGE_LOCK_TITLE_TEXT_MARGIN = 5,
    ROTATED_HOME_PAGE_LOCK_TITLE_TEXT_MARGIN = 5,
	HOME_PAGE_HORIZONTAL_MARGIN = 5, 
    ROTATED_HOME_PAGE_HORIZONTAL_MARGIN = 6,
	HOME_PAGE_VERTICAL_MARGIN = 5, 
    ROTATED_HOME_PAGE_VERTICAL_MARGIN = 6,
	HOME_PAGE_ICON_TEXT_FONT_SIZE = 14,
	ROTATED_HOME_PAGE_ICON_TEXT_FONT_SIZE = 14,
	HOME_PAGE_HORIZONTAL_EXTRA_MARGIN = 3,
	ROTATED_HOME_PAGE_HORIZONTAL_EXTRA_MARGIN = 2,
	HOME_PAGE_VERTICAL_EXTRA_MARGIN = 2,
	ROTATED_HOME_PAGE_VERTICAL_EXTRA_MARGIN = 2,
    FULL_SCREEN_ICON_POS_X = 255,
    FULL_SCREEN_ICON_POS_Y = 13,
    ROTATED_FULL_SCREEN_ICON_POS_X = 415,
    ROTATED_FULL_SCREEN_ICON_POS_Y = 13
#elif defined(__MMI_MAINLCD_240X320__)
    HOME_PAGE_ICON_WIDTH = 72 - 4,
    ROTATED_HOME_PAGE_ICON_WIDTH = 68 - 4,
    HOME_PAGE_ICON_HEIGHT = 73 - 2,
    ROTATED_HOME_PAGE_ICON_HEIGHT = 37 - 2,
    HOME_PAGE_ICON_TEXT_HEIGHT = 21 - 2,
    ROTATED_HOME_PAGE_ICON_TEXT_HEIGHT = 15 - 2,
    HOME_PAGE_ICON_LOCK_WIDTH = 10,
    ROTATED_HOME_PAGE_ICON_LOCK_WIDTH = 8,
    HOME_PAGE_ICON_LOCK_HEIGHT = 10,
    ROTATED_HOME_PAGE_ICON_LOCK_HEIGHT = 8,
    HOME_PAGE_ICON_TITLE_MARGIN = 5,
    ROTATED_HOME_PAGE_ICON_TITLE_MARGIN = 5,
    HOME_PAGE_LOCK_TITLE_TEXT_MARGIN = 3,
    ROTATED_HOME_PAGE_LOCK_TITLE_TEXT_MARGIN = 3,
    HOME_PAGE_HORIZONTAL_MARGIN = 3, 
    ROTATED_HOME_PAGE_HORIZONTAL_MARGIN = 4,
	HOME_PAGE_VERTICAL_MARGIN = 3, 
    ROTATED_HOME_PAGE_VERTICAL_MARGIN = 4,
	HOME_PAGE_ICON_TEXT_FONT_SIZE = 13,
	ROTATED_HOME_PAGE_ICON_TEXT_FONT_SIZE = 11,
	HOME_PAGE_HORIZONTAL_EXTRA_MARGIN = 0,
	ROTATED_HOME_PAGE_HORIZONTAL_EXTRA_MARGIN = 6,
	HOME_PAGE_VERTICAL_EXTRA_MARGIN = 0,
	ROTATED_HOME_PAGE_VERTICAL_EXTRA_MARGIN = 0,
    FULL_SCREEN_ICON_POS_X = 181,
    FULL_SCREEN_ICON_POS_Y = 13,
    ROTATED_FULL_SCREEN_ICON_POS_X = 261,
    ROTATED_FULL_SCREEN_ICON_POS_Y = 13
#elif defined(__MMI_MAINLCD_240X400__)
	HOME_PAGE_ICON_WIDTH = 72-4,
    ROTATED_HOME_PAGE_ICON_WIDTH = 68-4,
    HOME_PAGE_ICON_HEIGHT = 68-2,
    ROTATED_HOME_PAGE_ICON_HEIGHT = 37-2,
    HOME_PAGE_ICON_TEXT_HEIGHT = 19-2,
    ROTATED_HOME_PAGE_ICON_TEXT_HEIGHT = 15-2,
    HOME_PAGE_ICON_LOCK_WIDTH = 10,
    ROTATED_HOME_PAGE_ICON_LOCK_WIDTH = 8,
    HOME_PAGE_ICON_LOCK_HEIGHT = 10,
    ROTATED_HOME_PAGE_ICON_LOCK_HEIGHT = 8,
    HOME_PAGE_ICON_TITLE_MARGIN = 5,
    ROTATED_HOME_PAGE_ICON_TITLE_MARGIN = 4,
    HOME_PAGE_LOCK_TITLE_TEXT_MARGIN = 3,
    ROTATED_HOME_PAGE_LOCK_TITLE_TEXT_MARGIN = 3,
    HOME_PAGE_HORIZONTAL_MARGIN = 3, 
    ROTATED_HOME_PAGE_HORIZONTAL_MARGIN = 4,
	HOME_PAGE_VERTICAL_MARGIN = 3, 
    ROTATED_HOME_PAGE_VERTICAL_MARGIN = 4,
	HOME_PAGE_ICON_TEXT_FONT_SIZE = 13,
	ROTATED_HOME_PAGE_ICON_TEXT_FONT_SIZE = 11,
	HOME_PAGE_HORIZONTAL_EXTRA_MARGIN = 0,
	ROTATED_HOME_PAGE_HORIZONTAL_EXTRA_MARGIN = 8,
	HOME_PAGE_VERTICAL_EXTRA_MARGIN = 0,
	ROTATED_HOME_PAGE_VERTICAL_EXTRA_MARGIN = 0,
    FULL_SCREEN_ICON_POS_X = 181,
    FULL_SCREEN_ICON_POS_Y = 13,
    ROTATED_FULL_SCREEN_ICON_POS_X = 341,
    ROTATED_FULL_SCREEN_ICON_POS_Y = 13
#else
    HOME_PAGE_ICON_WIDTH = 94,
    ROTATED_HOME_PAGE_ICON_WIDTH = 84,
    HOME_PAGE_ICON_HEIGHT = 76,
    ROTATED_HOME_PAGE_ICON_HEIGHT = 78,
    HOME_PAGE_ICON_TEXT_HEIGHT = 24,
    ROTATED_HOME_PAGE_ICON_TEXT_HEIGHT = 24,
    HOME_PAGE_ICON_LOCK_WIDTH = 15,
    ROTATED_HOME_PAGE_ICON_LOCK_WIDTH = 15,
    HOME_PAGE_ICON_LOCK_HEIGHT = 15,
    ROTATED_HOME_PAGE_ICON_LOCK_HEIGHT = 15,
    HOME_PAGE_ICON_TITLE_MARGIN = 4,
    ROTATED_HOME_PAGE_ICON_TITLE_MARGIN = 4,
    HOME_PAGE_LOCK_TITLE_TEXT_MARGIN = 5,
    ROTATED_HOME_PAGE_LOCK_TITLE_TEXT_MARGIN = 5,
    HOME_PAGE_HORIZONTAL_MARGIN = 4, 
    ROTATED_HOME_PAGE_HORIZONTAL_MARGIN = 5,
	HOME_PAGE_VERTICAL_MARGIN = 3, 
    ROTATED_HOME_PAGE_VERTICAL_MARGIN = 5,
	HOME_PAGE_ICON_TEXT_FONT_SIZE = 14,
	ROTATED_HOME_PAGE_ICON_TEXT_FONT_SIZE = 14,
	HOME_PAGE_HORIZONTAL_EXTRA_MARGIN = 0,
	ROTATED_HOME_PAGE_HORIZONTAL_EXTRA_MARGIN = 8,
	HOME_PAGE_VERTICAL_EXTRA_MARGIN = 0,
	ROTATED_HOME_PAGE_VERTICAL_EXTRA_MARGIN = 1,
    FULL_SCREEN_ICON_POS_X = 255,
    FULL_SCREEN_ICON_POS_Y = 13,
    ROTATED_FULL_SCREEN_ICON_POS_X = 415,
    ROTATED_FULL_SCREEN_ICON_POS_Y = 13
#endif
};


extern void widget_paintbox_create_doubble_buffer( 
        U32 x,
        U32 y,
        U32 w,
        U32 h);
extern gdi_handle paintbox_layer_handle;

#define SHORTCUT_URL_LENGTH 40
typedef struct
{
    VfxU16 imageId;
    VfxChar shortcutUrl[SHORTCUT_URL_LENGTH];
} shortcutsDB_struct;


class VappBrwRenderPagecp : public VfxControl
{
    //VFX_DECLARE_CLASS(VappBrwTitleBar);


public:
	VappBrwRenderPagecp(){};
    virtual ~VappBrwRenderPagecp() {};


public:
    virtual void onInit(void);
	virtual void onDeinit(void);
	virtual void onUpdate(){};
	virtual VfxBool onKeyInput(VfxKeyEvent &event);
    //virtual VfxBool onPenInput(VfxPenEvent& event);


};

#ifdef __MMI_BRW_SLIM__
class VappBrowserHomePageDataProvider : public VfxObject, public IVcpListMenuContentProvider
{
	public:
		VfxImageSrc shortcutImage; 
		VfxWString shotcutTitle;
		VfxU32      totalShortcut;

	virtual VfxBool getItemText(
        VfxU32 index,                    // [IN] the index of item
        VcpListMenuFieldEnum fieldType,  // [IN] the type of the field in the cell
        VfxWString &text,                // [OUT] the text resource
        VcpListMenuTextColorEnum &color  // [OUT] the text color
        );

    virtual VfxBool getItemImage(
        VfxU32 index,                    // [IN] the index of item
        VcpListMenuFieldEnum fieldType,  // [IN] the type of the field in the cell
        VfxImageSrc &image              // [OUT] the image resource
        );
	 
	virtual VfxU32 getCount() const 
	    {
		return totalShortcut;
	    }
	
	
	virtual VfxBool getItemTextFrameFormat(
        VfxU32 index,                   // [IN] the index of item
        VcpListMenuFieldEnum fieldType, // [IN] the type of the field in the cell
        VfxTextFrame *frame             // [OUT] the text frame
        );
	
};

class VappUrlInputPopup : public VcpInputPopup
{
	private:
		VfxU32 m_index;
		VfxBool m_isShortCut;
	public:
		void setIndex(VfxU32 index)
		{
			m_index = index;
		}
		VfxU32 getIndex()
		{
			return m_index;
		}
		void setIsShortCut(VfxBool isShortCut)
		{
			m_isShortCut = isShortCut;
		}
		VfxBool getIsShortCut()
		{
			return m_isShortCut;
		}
};

#endif

class VappBrowserPage : public VfxPage
{
    //VFX_DECLARE_CLASS(VappBrowserPage);

// Override
public:

VappBrowserPage() :
m_renderPageCP(NULL),
m_selectedShortcutID(0),
m_commandPopup(NULL),
m_toolBar(NULL),
m_page_panel(NULL),
m_frame1(NULL),
m_isHomepageMode(VFX_FALSE),
m_titleBar(NULL),
m_searchItemList(NULL),
m_editItemListContentProvider(NULL),
m_backgroundFrame(NULL),
m_wapListMenu(NULL),
m_authenticationInput(NULL),
m_editorInput(NULL),
#if (defined (WAP_SEC_SUPPORT)  && !defined (__LOW_COST_SUPPORT_COMMON__))
m_secConfirmPopup(NULL),
#endif
m_progressValue(0),
m_isFullScreenMode(VFX_FALSE),
#ifdef __MMI_BRW_FILE_UPLOAD_SUPPORT__
m_uploadProgress(NULL),
m_uploadCompleted(NULL),
m_uploadTimer(NULL),
#endif
m_wapListOkSelected(VFX_FALSE),
m_connectionTimer(NULL),
m_isShortcutFetchedSuccessfully(VFX_FALSE),
m_secRequestID(0),
m_iconWidth(0),
m_iconHeight(0),
m_lockIconWidth(0),
m_lockIconHeight(0),
m_iconTextHeight(0),
m_iconTitleMargin(0),
m_HorizontalpageMargin(0),
m_VerticalpageMargin(0),
m_HorizontalExtraMargin(0),
m_LockTitleTextMargin(0),
m_VerticalExtraMargin(0),
m_NoOfColmns(0),
m_NoOfRows(0),
m_iconTextFontSize(0),
m_relaunchNeeded(VFX_FALSE),
m_exitFullScreenIcon(NULL),
#ifndef __MMI_BRW_SLIM__
m_homePage(NULL),
#else
m_homePageList(NULL),
m_homePageDataProvider(NULL),
#endif
m_isMassStorageMode(VFX_FALSE),
m_titleTextBuffer(NULL),
m_clickOk(VFX_FALSE),
m_popup(NULL),
m_contextMenu(NULL),
m_isStopFetching(VFX_FALSE)


{

}
    enum
    {
        BROWSER_PAGE_BACK,
        BROWSER_PAGE_FORWARD,
        BROWSER_PAGE_FAVOTIRES,
        BROWSER_PAGE_ADD,
		#ifndef __MMI_BRW_SLIM__
        BROWSER_PAGE_SHARE,
        #endif
        BROWSER_PAGE_SETTINGS,
        BROWSER_PAGE_EXIT_BROWSER,
        BROWSER_PAGE_END
    };

    enum
    {
        COMMAND_ADD_TO_BOOKMARKS,
        COMMAND_ADD_SAVE_PAGE,
        COMMAND_ADD_CANCEL,
        COMMAND_ADD_END
    };

    enum
    {
        COMMAND_SHORTCUT_LOCK,
        COMMAND_SHORTCUT_UNLOCK,
        COMMAND_SHORTCUT_EDIT,
        COMMAND_SHORTCUT_DELETE,
        COMMAND_SHORTCUT_END
    };

    enum
    {
        AUTH_EDITOR_USERNAME,
        AUTH_EDITOR_PASSWORD,
        AUTH_EDITOR_TOTAL
    };

    enum
    {
        IMAGE_OPTION_OPEN,
        IMAGE_OPTION_SAVE,
        IMAGE_OPTION_END
    };
	VappBrwRenderPagecp *m_renderPageCP;
    VfxRect g_page_rect;
	#ifndef __MMI_BRW_SLIM__
    VfxU8 m_selectedShortcutID;
	#else
	VfxU32 m_selectedShortcutID;
	#endif
    VcpCommandPopup *m_commandPopup;
    VcpToolBar *m_toolBar;
    VcpPagePanel *m_page_panel;
    VfxFrame *m_frame1;
    VcpTitleBar * titleBar;
	#ifndef __MMI_BRW_SLIM__
    
	#else
	VfxWChar *m_urlBuffer;
	VappUrlInputPopup *m_inputPopup;
	#endif
    VfxBool m_isHomepageMode;
    VappBrwTitleBar *m_titleBar;
    VcpListMenu *m_searchItemList;
    VappBrowserSearchListDataProvider *m_editItemListContentProvider;
    VfxFrame *m_backgroundFrame;
    VcpSelectPopup *m_wapListMenu;
    VcpInputPopup *m_authenticationInput;
    VcpInputPopup *m_editorInput;
#if (defined (WAP_SEC_SUPPORT)   && !defined (__LOW_COST_SUPPORT_COMMON__))
    VcpConfirmPopup *m_secConfirmPopup;
#endif
    VfxU8 m_progressValue;
    vappBrwListMenuChoiceEnum m_wapListType;
    VfxRect m_fullsScreenIconSize;
    VfxBool m_isFullScreenMode;
#ifdef __MMI_BRW_FILE_UPLOAD_SUPPORT__
    VcpIndicatorPopup *m_uploadProgress;
    VcpIndicatorPopup *m_uploadCompleted;
    VfxTimer *m_uploadTimer;
#endif
    VfxBool m_wapListOkSelected;
    VfxTimer *m_connectionTimer;
    VfxBool m_isShortcutFetchedSuccessfully;
    VfxU8 m_secRequestID;
    VfxU16 m_iconWidth;
    VfxU16 m_iconHeight;
    VfxU16 m_lockIconWidth;
    VfxU16 m_lockIconHeight;
    VfxU16 m_iconTextHeight;
    VfxU16 m_iconTitleMargin;
	VfxU16 m_HorizontalpageMargin;
    VfxU16 m_VerticalpageMargin;
	VfxU16 m_HorizontalExtraMargin;
	VfxU16 m_LockTitleTextMargin;
	VfxU16 m_VerticalExtraMargin;
    VfxU16 m_NoOfColmns;
    VfxU16 m_NoOfRows;
    VfxU8 m_selectedShortcutIndex;
	VfxU16 m_iconTextFontSize;
	VfxBool m_relaunchNeeded;
	VcpImageButton *m_exitFullScreenIcon;
	#ifndef __MMI_BRW_SLIM__
	VappBrwHomePage *m_homePage;
	#endif
	#ifdef __MMI_BRW_SLIM__
	VcpListMenu *m_homePageList;
	VappBrowserHomePageDataProvider *m_homePageDataProvider;
	#endif
	VfxBool m_isMassStorageMode;
	VfxWChar *m_titleTextBuffer;
	VfxBool m_clickOk;
    VcpIndicatorPopup *m_popup;
    VcpMenuPopup *m_contextMenu;
    VfxObjWeakPtr m_parent;
    VfxBool m_isStopFetching;

    void onTBClick(VfxObject* sender, VfxId id);
    virtual void onInit();
    virtual void onDeinit();
    virtual void onBack();
    virtual void processRotate(const VfxScreenRotateParam &param);
    void onAddCommandCallClick(VfxObject *obj, VfxId id);
    void updateToolBarItemsState(void);
    virtual void onUpdate();
    void notifyScreenInfo(VfxU8 x, VfxU8 y, VfxU16 w, VfxU16 h, VfxS32 handle1, VfxS8 handle2, VfxS8 isRefresh);
    void suspendBrowserRendering(void);
    void resumeBrowserRendering(void);
    virtual void onEnter(VfxBool isBackward);
	virtual void onEntered();
    virtual void onExit(VfxBool isBackward);
    void onFullScreenIconTap();
    //VfxScrRotateTypeEnum onQueryRotate(const VfxScreenRotateParam &param);
    void onFullScreenRotate(VfxU32 rotateAngle);
    virtual void onRotate(const VfxScreenRotateParam &param);
    virtual VfxBool onKeyInput(VfxKeyEvent & event);
    void fullScreenModeExit();
	#ifndef __MMI_BRW_SLIM__
	void updateHomePageElemSize(void);
    void getHomepageShortcutInfo(VfxU8 index, VfxImageSrc &shortcutImage, VfxWString &shotcutTitle, VfxBool &isLocked);
    void onShortcutItemTap(VfxU8 index);
    void onShortcutLongTap(VfxU8 index);
    void contextMenuCallack(VcpMenuPopup *menu, VcpMenuPopupEventEnum event, VcpMenuPopupItem *item);
    void shortcutDeleteHandler(VfxObject* obj, VfxId id);
	#endif
    void transactionCallback(U8 transactionStatus, void *userData);
    void documentInfoCallback(void *userData);
#if (defined (WAP_SEC_SUPPORT)  && !defined (__LOW_COST_SUPPORT_COMMON__))
    void secConfirmCallback(void *userData);
#endif
    void errorIndCallback(void *userData);
    void displayWapEditor(void *obj);
    void vappBrwSendTouchFeedbackCallback(mmi_pen_event_type_enum pen_input_type);
    void displayAuthentication(void);
#ifdef __MMI_BRW_FILE_UPLOAD_SUPPORT__
    void selectUploadFile(void);
#endif
    void displayWapListMenu(vappBrwListMenuChoiceEnum listType);
    void OnAuthenticationButtonClicked(VfxObject* sender, VcpInputPopupButtonEnum id);
#if (defined (WAP_SEC_SUPPORT) && !defined (__LOW_COST_SUPPORT_COMMON__))
    void secConfirmEventHandler(VfxObject* obj, VfxId id);
#endif
    void insufficientMemoryEventHandler(VfxObject* obj, VfxId id);
    void onHomePageIconTap();
    void onDisplayExitFullScreenIcon();
    void removePageBars();
    void addPageBars();
    void updateTitleBarState(VfxBool enable);
    void serverConnectionTimerCallback(VfxTimer *timer);
    void onTitleBarEditorIconTap();
    void onEnterKeyClicked(VcpTextEditor *editor, IMEVKEnterKeyStyleEnum enterKeyStyle);
    void exitBrowserHandler(VfxObject* obj, VfxId id);
    void onExitConfrmPopupStateChanged(VfxBasePopup* popup, VfxBasePopupStateEnum state);
    void OnEditorButtonClicked(VfxObject* sender, VcpInputPopupButtonEnum id);
    void fmgrCuiCallback(void *param);
    void displayImageOptions(void);
    virtual void onQueryRotateEx(VfxScreenRotateParam &param);
    void imageMenuCallack(VcpMenuPopup *menu, VcpMenuPopupEventEnum event, VcpMenuPopupItem *item);
#ifdef __MMI_BRW_FILE_UPLOAD_SUPPORT__
    void showUploadProgress(void);
    void onUploadCancelClick(VfxObject* sender, VfxFloat curr_progress);
    void onUploadTimerCallBack(VfxTimer *timer);
    void formatUploadSizeTotal(VfxU32 bytesSent, VfxU32 bytesTotal, VfxChar *outputBuff);
    void formatUploadSize(VfxU64 size, VfxChar *outputBuff);
#endif
    void showWmlsDialog(void *param);
    void OnPromptButtonClicked(VfxObject* sender, VcpInputPopupButtonEnum id);
    void OnWmlsConfirmButtonClicked(VfxObject *obj, VfxId id);
    void relaunchBrowserCallback(void);
    void usbModeCallback(VfxU8 isEnter);
    void displayPage(void);
    void onTextViewerActivated(VcpTextView *viewer, VcpTextTapAreaEnum area, VcpRichTextFormat *format);
    virtual void updateLayerHandle(VfxU32 layerHandle);
    void onClickFullScreenIcon(VfxObject *obj, VfxId id);
    void rotationTimerCallback(VfxTimer *timer);
    void onTitleBarEditorKeyInput(VfxKeyEvent &event);
#ifdef __BAIDU_TRANSCODING_SUPPORT__
    void onBaiduProxyErrorConfirm(VfxObject* obj, VfxId id);
#endif /* #ifdef __BAIDU_TRANSCODING_SUPPORT__ */
    void wifiBearerCallback(VfxU32 state, VfxU32 errorCause);
    void launchUrlCallback(void);
#ifdef MMI_BRW_BEARER_SWITCH_SUPPORT
    void bearerSwitchCallback(VfxBool isSocketClosed);
    void relaunchUrlCallback(void);
    void wifiBearerSwitchCallback(VfxU32 state, VfxU32 errorCause);
#endif
    void homepageSnapshotCallback(void);
    void openBearerCallback(void);
    void displayProgressPopupCallback(void);
    void closeProgressPopupCallback(void);

	#ifdef __MMI_BRW_SLIM__
	void createHomePageList(void);
	void setHomePageListTotalNumber(void);
	void onShortCutListItemTap(VcpListMenu *sender, VfxU32 index);
	void onShortCutListItemLongTapped(VcpListMenu *sender, VfxU32 index);
	void shortCutMenuPopupCallBack(VcpMenuPopup *menu, VcpMenuPopupEventEnum event, VcpMenuPopupItem *item);
	void shortCutMenuDeleteCallBack(VfxObject* obj, VfxId id);
	void createUrlInputPopup(VfxS32 index, VfxBool isShortCut);
	void onInputPopupBtnClicked(VfxObject* sender, VcpInputPopupButtonEnum id);
	#endif
};

class VappBrowserUtility
{
public:
    static void displayPopup(VfxU16 displayStr, mmi_nmgr_balloon_type_enum balloon_type, mmi_event_notify_enum event_id );
    static VcpConfirmPopup* displayConfirmPopup(VfxObject *page, VcpPopupTypeEnum popupType, const VfxWString &msgString, const VfxWString &buttonString);
    static VcpConfirmPopup* displayDeleteConfirmPopup(VfxObject *page, VcpPopupTypeEnum popupType, const VfxWString &msgString, const VfxWString &buttonString);
    static VfxBool checkAvailableBookmarkMemory(void);
    static void fileSystemErrorHandler(VfxS32 error_code);
    static VfxU16 getErrorString(VfxS32 error_code); 
    static void wpsErrorHandler(U16 error_code);
    static void bamErrorHandler(U16 error_code);
    static VfxU8 getBookmarkItems(VfxU8* sel_folder_name, srv_brw_bkm_bookmark_list_struct* bkm_list);
    static VfxS32 deleteBookmarkFolder(VfxU8 selFolderIndex);
    static kal_int8 openBearer(void);
    static VfxBool checkNetworkStatus(void);
    static VfxBool checkSrvNwUsabIsAnyNetworkAvailable(void);
	static VfxBool setSimSettingId(void);
};


class VappBrowserASMMemoryMgmt
{
private:
    void *m_asmMemoryPtr;
    KAL_ADM_ID brw_adm_id;
public:
    VappBrowserASMMemoryMgmt(void):
    m_asmMemoryPtr(NULL),
    brw_adm_id(0)
    {
    }

    static void* allocMemory(U32 size);
    static void freeMemory(void* memPtr);
};
#ifdef __MMI_BRW_STORED_PAGES_SUPPORT__

/****************************************************************************
* Class VappBrowserAddPage
****************************************************************************/
class VappBrowserAddPage : public VfxPage
{
public:
    enum
    {
        ADD_PAGE_SAVE = 0,
        ADD_PAGE_CANCEL,
        ADD_PAGE_END
    } ;

    VfxWChar *m_pageTitle;
    VfxWChar *m_pageUrl;
    VcpTitleBar *m_titleBar;
    VcpForm *m_form;
    VcpFormItemCaption *m_titleCaption;
    VcpFormItemTextInput *m_titleInput;
    VcpFormItemCaption *m_urlCaption;
    VcpFormItemCustomFrame *m_urlInput;
	VcpFunctionBar *m_funcBar;
    VcpTextView *m_urlView;
    VcpToolBar *m_toolBar;
    VcpIndicatorPopup *m_popup;
    
    VappBrowserAddPage(VfxWChar *pageTitle, VfxWChar *pageUrl);

    virtual void onInit();
    virtual void onDeinit();
    void onTBClick(VfxObject* sender, VfxId id);
    void savePageCallback(S32 userData, U32 result, void *data);
    //virtual VfxScrRotateTypeEnum onQueryRotate(const VfxScreenRotateParam &param);
    virtual void onQueryRotateEx(VfxScreenRotateParam &param);
    void onFuncBarItemSelected(VfxObject *sender, VfxId id);
};
#endif

class VappWapListMenucontentprovider : public VfxObject, public IVcpListMenuContentProvider
{
public:
	virtual void setMenu(VcpListMenu *)
	{
	}
	virtual VfxBool getItemText(
	VfxU32 index,                    // [IN] the index of item
	VcpListMenuFieldEnum fieldType,  // [IN] the type of the field in the cell
	VfxWString &text,                // [OUT] the text resource
	VcpListMenuTextColorEnum &color  // [OUT] the text color
	);

	virtual VfxBool getItemImage(
	VfxU32 index,                    // [IN] the index of item
	VcpListMenuFieldEnum fieldType,  // [IN] the type of the field in the cell
	VfxImageSrc &image              // [OUT] the image resource
	);

	virtual void closeItemImage(
	VfxU32 index,                    // [IN] the index of item
	VcpListMenuFieldEnum fieldType, // [IN] the type of the field in the cell
	VfxImageSrc Image               // [IN] the image resource
	)
	{
	// move to .cpp if required
	}

	virtual VfxU32 getCount()const;
	// Get the state of a list item
	virtual VcpListMenuItemStateEnum getItemState(VfxU32 index)const;

};


class VappWapListMenuPage : public VfxPage
{
	//VFX_DECLARE_CLASS(VappWapListMenuPage);
public:
	
    VappWapListMenuPage()
    {};
    VappWapListMenuPage(vappBrwListMenuChoiceEnum list_type) : 
        m_listmenu_type(list_type) 
    {};
	virtual void onInit();
	virtual void onDeinit();
	
	VfxFrame *getContentFrame(
        VcpMenuPos pos        // [IN] index of the item
		)
	{
	    return NULL;
	}

	void onWapListMenuToolBarClick(VfxObject* sender, VfxId id);
    
	void m_signalListItemSelected(VcpListMenu *listmenu, VfxU32 id, VcpListMenuItemStateEnum state);
	// todo: relook private: done
	void updatelistmenu(void){}  /* Redraw UI on basis of data on APP */

	void refresh_list(void){}   /* Get fresh data from APP */

	VcpToolBar *m_tool_bar;
	VcpTitleBar * titleBar;
    virtual void onBack();
	void m_signalListItemTapped(VcpListMenu *, VfxU32);

	void m_signalListFocusChanged(VcpListMenu *, VfxU32,VfxU32){}

	vappBrwListMenuChoiceEnum m_listmenu_type ;
	U8* m_selectedListInfo;
    U32 m_index;
	VfxBool m_sel_ids[3];
	VcpListMenu *m_list;
    VfxBool m_shown;
	VappWapListMenucontentprovider *m_waplistcontentprovider;
	virtual void onEnter(VfxBool isBackward);
	//virtual VfxScrRotateTypeEnum onQueryRotate(const VfxScreenRotateParam &param);
    virtual void onQueryRotateEx(VfxScreenRotateParam &param);
	void  m_updateselecteditemsinfo(void);
	//void onRotate(const VfxScreenRotateParam &param);
};


class VappBrowserScreen : public VfxMainScr
{
    //VFX_DECLARE_CLASS(VappBrowserScreen);

// Override
public:
    enum
    {
        BRW_PAGE_FAVOURITES = 1,
        BRW_PAGE_END
    };
    VappBrowserPage *page;
    VappBrowserFavouritesPage *m_favouritePage;
    #ifdef __MMI_BRW_STORED_PAGES_SUPPORT__
    VappBrowserStoredPageDetailsPage *m_storedPageDetailsPage;
    #endif
	#ifdef __MMI_BRW_SLIM__
	VappBrowserBookmarkPage *m_bookmarkPage;
	#endif
    VappBrowserBookmarksDetailsPage *m_bookmarkDetailsPage;
    VappBrowserAddBookmark *m_addBookmarkPage;
    #ifdef __MMI_BRW_BKM_FOLDER_SUPPORT__
    VappBrowserBookmarkFolderPage *m_bookmarkFolderPage;
    VappBrowserSelectFolderPage *m_selectFolderPage;
    #endif
    VappBrowserEditShortcut *m_editShortcutPage;
    #ifdef __MMI_BRW_STORED_PAGES_SUPPORT__
    VappBrowserAddPage *m_addPage;
    #endif
    VappSettingsPage *m_settings;
    VappStaticListPage *m_StaticListPage;
#if (defined (WAP_SEC_SUPPORT)  && !defined (__LOW_COST_SUPPORT_COMMON__))
    VappBrwTrustedCertViewerPage *m_TrustedCertViewerPage;
#endif
    VcpIndicatorPopup *m_popup;
    VappWapListMenuPage *m_waplistmenu;
    VfxBool m_isScreenFirstEnter;
    VfxBool m_isAddBookMarkSuccess;
    VfxBool m_isProfileUpdateNeeded;

    VappBrowserScreen():
    page(NULL),
    m_favouritePage(NULL),
    #ifdef __MMI_BRW_STORED_PAGES_SUPPORT__
    m_storedPageDetailsPage(NULL),
    #endif
    m_bookmarkDetailsPage(NULL),
    m_addBookmarkPage(NULL),
    #ifdef __MMI_BRW_BKM_FOLDER_SUPPORT__
    m_bookmarkFolderPage(NULL),
    m_selectFolderPage(NULL),
    #endif
    m_editShortcutPage(NULL),
    #ifdef __MMI_BRW_STORED_PAGES_SUPPORT__
    m_addPage(NULL),
    #endif
    m_settings(NULL),
    m_StaticListPage(NULL),
#if (defined (WAP_SEC_SUPPORT)  && !defined (__LOW_COST_SUPPORT_COMMON__))
    m_TrustedCertViewerPage(NULL),
#endif
    m_popup(NULL),
    m_waplistmenu(NULL),
    m_isScreenFirstEnter(VFX_FALSE),
    m_isAddBookMarkSuccess(VFX_FALSE),
    m_isProfileUpdateNeeded(VFX_FALSE)
    {
		setAppContextShareForVrt(VFX_TRUE);
    }
    virtual void onInit()
    {
        VfxMainScr::onInit();
    }
    virtual void on1stReady();
    virtual void on2ndReady();
    virtual void onDeinit();
    virtual void onRotate(const VfxScreenRotateParam &param);
    virtual void onQueryRotateEx(
        VfxScreenRotateParam &param // The parameter to rotate
    );
    void createServiceInstance(void);
    void createServiceInstanceCallback(S32 userData, U32 result, void *data);
    virtual VfxBool onPenInput(VfxPenEvent& event);
    //VfxBool onKeyInput(VfxKeyEvent &event);
    void setProfileCallback(void);
	virtual mmi_ret onProc(mmi_event_struct * evt);

	// While screen to be active and after it displayed
    virtual void onEntered(VfxBool isBackward);

	// while exit the screen
    virtual void onExited(VfxBool isBackward);
	
protected:
    virtual void processEnter(VfxBool isBackward);
    
};

class VappBrowserApp : public VfxApp
{
    VFX_DECLARE_CLASS(VappBrowserApp);

protected:
	using VfxApp::onProcessClose;
	
// Override
public:
    VfxBool isInternallyClosed;
    VfxBool isProcessingClosed;
    VappBrowserApp():
        isInternallyClosed(VFX_FALSE),
        isProcessingClosed(VFX_FALSE)
    {}

    virtual void onRun(void* args, VfxU32 argSize);
    VappBrowserScreen *scr;
    virtual void onDeinit();
    virtual mmi_ret onProc(mmi_event_struct *param);
    static VfxSignal1<void *> m_eventCallback;
    virtual VfxAppCloseAnswerEnum onProcessClose(VfxAppCloseOption options);
    VfxBool closeBrowserService(void);
    void deleteInstanceCallback(VfxU8 isBrowserClosed);
    void internalTerminateCallback(void);
} ;

#ifndef __MMI_BRW_SLIM__
class VappBrowserShareLink : public VcpCommandPopup
{
public:
    enum
    {
        COMMAND_SHARE_VIA_SMS,
        COMMAND_SHARE_VIA_MMS,
        COMMAND_SHARE_VIA_EMAIL,
        COMMAND_SHARE_VIA_BT,
        COMMAND_SHARE_CANCEL,
        COMMAND_SHARE_VIA_END
    };

    VfxWChar *m_shareUrl;
    VappBrowserShareLink(VfxWChar *shareUrl);
    void showCommandPopup(void);
    void onShareCommandCallClick(VfxObject *obj, VfxId id);
    virtual ~VappBrowserShareLink()
    {
        if(m_shareUrl)
        {
            VappBrowserASMMemoryMgmt::freeMemory(m_shareUrl);
            m_shareUrl = NULL;
        }
    }
};
#endif	//	?__MMI_BRW_SLIM__

class VappBrowserTextAreaInputPopup : public VcpInputPopup
{
	public:
		enum
		{
			COMMAND_INPUT_POPUP_YES,
			COMMAND_INPUT_POPUP_CANCEL,
			COMMAND_INPUT_POPUP_END

		};
	VfxWChar *m_textAreaContent;
	VfxS32 m_contectlength;
	VappBrowserTextAreaInputPopup();
	virtual ~VappBrowserTextAreaInputPopup();
	//virtual void onInit();
	void showCommandPopup(void);
	// over write this api
	virtual void onUpdate();
	void onInputCommandCallback(VfxObject *obj, VfxId id);
};

extern mmi_id m_browserAppID;
extern mmi_id m_bowserBookmarkCuiId;

#endif /*__MMI_BROWSER_2__ */

#endif /* _VAPP_BRW_MAIN_H_ */
